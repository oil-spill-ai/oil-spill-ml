# ML микросервис сегментации разливов нефти

Этот микросервис реализует REST API для сегментации изображений с разливами нефти. Построен на FastAPI и предназначен для независимого использования и тестирования.

## Основные эндпоинты

- **POST /segment** — принимает изображение, возвращает результат сегментации (image/jpeg)
- **GET /health** — проверка работоспособности
- **GET /stats** — статистика обработки
- **POST /clear-tmp** — очистка временных файлов

## Как работает сервис

1. Загруженное изображение сохраняется во временную директорию `/tmp/uploads`.
2. Запускается функция сегментации (`predict_image`), результат сохраняется в `/tmp/results/job_results`.
3. Сегментированное изображение возвращается пользователю в ответе.

## Запуск

Установите зависимости:
```bash
pip install -r requirements.txt
```

Запустите сервис:
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8002
# или ./run.sh
```

## Тестирование без бэкенда

### Ручное тестирование через curl

**Сегментация изображения:**
```bash
curl -F "file=@test.jpg" http://localhost:8002/segment --output result.jpg
```

**Проверка работоспособности:**
```bash
curl http://localhost:8002/health
```

**Очистка временных файлов:**
```bash
curl -X POST http://localhost:8002/clear-tmp
```


---

**Примечание:**
- Временные файлы хранятся в `/tmp/uploads` и `/tmp/results`. Если хотите хранить их в директории проекта, измените пути в `app/main.py`.
- Для интеграции с другим бэкендом используйте HTTP-запросы к этим эндпоинтам.